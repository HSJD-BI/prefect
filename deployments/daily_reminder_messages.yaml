name: whatsapp_scrapping_msg
prefect-version: 3.6.5

pull:
  - prefect.deployments.steps.git_clone:
      id: clone-step
      repository: https://github.com/HSJD-BI/whatsapp_scrapping.git
      branch: "{{ prefect.variables.deployment_branch }}"
      credentials: "{{ prefect.blocks.github-credentials.reminders-profile }}"  
  - prefect.deployments.steps.run_shell_script:
      script: uv pip install -r requirements.txt
      stream_output: true
      directory: "{{ clone-step.directory }}"

deployments:
  - name: deploy-open-browser-1
    description: "Abrir navegador para iniciar sesión en Whatsapp."
    flow_name: open-persistent-browser
    entrypoint: flows/open_browser_flow.py:open_browser_flow
    work_pool:
      name: "vm-BI2"
      job_variables:
        env:
          PREFECT_API_URL: "http://10.0.1.120:4200/api"
          DATA_PATH: "/home/ububi/Documentos/Bi/whatsapp_scrapping/profiles/whatsapp_profile"
  
  - name: deploy-open-browser-2
    description: "Abrir navegador para iniciar sesión en Whatsapp."
    flow_name: open-persistent-browser
    entrypoint: flows/open_browser_flow.py:open_browser_flow
    work_pool:
      name: "vm-BI1"
      job_variables:
        env:
          PREFECT_API_URL: "http://10.0.1.120:4200/api"
          DATA_PATH: "/home/ububi/Documentos/Bi/whatsapp_scrapping/profiles/whatsapp_profile"
  
  - name: deploy-open-browser-3
    description: "Abrir navegador para iniciar sesión en Whatsapp."
    flow_name: open-persistent-browser
    entrypoint: flows/open_browser_flow.py:open_browser_flow
    work_pool:
      name: "vm-BI6"
      job_variables:
        env:
          PREFECT_API_URL: "http://10.0.1.120:4200/api"
          DATA_PATH: "/home/ububi/Documentos/Bi/whatsapp_scrapping/profiles/whatsapp_profile"

  - name: deploy-send-messages-1
    description: "Abrir navegador para iniciar sesión en Whatsapp."
    flow_name: enviar-mensaje-recordatorios
    entrypoint: flows/send_messages_flow.py:send_messages_reminders
    work_pool:
      name: "vm-BI2"
      job_variables:
        env:
          PREFECT_API_URL: "http://10.0.1.120:4200/api"
          DATA_PATH: "/home/ububi/Documentos/Bi/whatsapp_scrapping/profiles/whatsapp_profile"
          DB_CONNECTION_STRING: "Driver={ODBC Driver 18 for SQL Server};Server=10.0.0.235;Database=DW;UID=Scheduler_02;PWD=Hospi21*talDw02;Encrypt=yes;TrustServerCertificate=yes"
          PROFILE_ID: "1"
          SERVICIOS: '{{ prefect.variables.servicios }}'
          START_HOUR: "{{ prefect.variables.start_hour }}"
          CUTOFF_HOUR: '{{ prefect.variables.cutoff_hour }}'
          MIN_MESSAGE_DELAY: '{{ prefect.variables.min_message_delay }}'
          MAX_MESSAGE_DELAY: '{{ prefect.variables.max_message_delay }}'
          MIN_ACTION_DELAY: '{{ prefect.variables.min_action_delay }}'
          MAX_ACTION_DELAY: '{{ prefect.variables.max_action_delay }}'


  - name: deploy-send-messages-2
    description: "Abrir navegador para iniciar sesión en Whatsapp."
    flow_name: enviar-mensaje-recordatorios
    entrypoint: flows/send_messages_flow.py:send_messages_reminders
    work_pool:
      name: "vm-BI1"
      job_variables:
        env:
          PREFECT_API_URL: "http://10.0.1.120:4200/api"
          DATA_PATH: "/home/ububi/Documentos/Bi/whatsapp_scrapping/profiles/whatsapp_profile"
          DB_CONNECTION_STRING: "Driver={ODBC Driver 18 for SQL Server};Server=10.0.0.235;Database=DW;UID=Scheduler_02;PWD=Hospi21*talDw02;Encrypt=yes;TrustServerCertificate=yes"
          PROFILE_ID: "2"
          SERVICIOS: '{{ prefect.variables.servicios }}'
          START_HOUR: '{{ prefect.variables.start_hour }}'
          CUTOFF_HOUR: '{{ prefect.variables.cutoff_hour }}'
          MIN_MESSAGE_DELAY: '{{ prefect.variables.min_message_delay }}'
          MAX_MESSAGE_DELAY: '{{ prefect.variables.max_message_delay }}'
          MIN_ACTION_DELAY: '{{ prefect.variables.min_action_delay }}'
          MAX_ACTION_DELAY: '{{ prefect.variables.max_action_delay }}'


  - name: deploy-send-messages-3
    description: "Abrir navegador para iniciar sesión en Whatsapp."
    flow_name: enviar-mensaje-recordatorios
    entrypoint: flows/send_messages_flow.py:send_messages_reminders
    work_pool:
      name: "vm-BI6"
      job_variables:
        env:
          PREFECT_API_URL: "http://10.0.1.120:4200/api"
          DATA_PATH: "/home/ububi/Documentos/Bi/whatsapp_scrapping/profiles/whatsapp_profile"
          DB_CONNECTION_STRING: "Driver={ODBC Driver 18 for SQL Server};Server=10.0.0.235;Database=DW;UID=Scheduler_02;PWD=Hospi21*talDw02;Encrypt=yes;TrustServerCertificate=yes"
          PROFILE_ID: "3"
          SERVICIOS: '{{ prefect.variables.servicios }}'
          START_HOUR: '{{ prefect.variables.start_hour }}'
          CUTOFF_HOUR: '{{ prefect.variables.cutoff_hour }}'
          MIN_MESSAGE_DELAY: '{{ prefect.variables.min_message_delay }}'
          MAX_MESSAGE_DELAY: '{{ prefect.variables.max_message_delay }}'
          MIN_ACTION_DELAY: '{{ prefect.variables.min_action_delay }}'
          MAX_ACTION_DELAY: '{{ prefect.variables.max_action_delay }}'
